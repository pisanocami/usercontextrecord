Perfecto.
AcÃ¡ van **instrucciones DIRECTAS para el dev**, en formato **operativo**, sin teorÃ­a, para **arreglar el problema actual** (demasiados PASS, oportunidades falsas) **sin romper el sistema**.

Esto es **quÃ© tocar, en quÃ© orden y con quÃ© cÃ³digo**.

---

# ğŸ¯ OBJETIVO PARA EL DEV

> Ajustar el motor para que:
>
> * **NO pasen keywords irrelevantes**
> * **PASS sea escaso y defendible**
> * **REVIEW vuelva a existir**
> * **Gate G y H hagan trabajo real**
>
> Sin cambiar arquitectura, solo **calibraciÃ³n + reglas**.

---

# ğŸ§± PASO 1 â€” ENDURECER GATE G (OBLIGATORIO)

ğŸ“ **Archivo:**
`shared/rules/packs/keyword.negative_scope.v1.json`

### 1.1 Agregar exclusiones por intent irrelevante

ğŸ‘‰ **Agregar esta regla** (copiar/pegar):

```json
{
  "ruleId": "negative_scope.irrelevant_intent",
  "appliesTo": "item",
  "ucrSection": "G",
  "severity": "critical",
  "when": {
    "op": "regex_match",
    "left": "$item.keyword",
    "right": "(pdf|training plan|marathon|half marathon|workout|training schedule|what is|are .* business casual|can you .*)"
  },
  "then": {
    "set": {
      "disposition": "OUT_OF_PLAY",
      "reason": "Irrelevant or informational intent"
    },
    "trace": true
  }
}
```

### 1.2 Regla dura para competitor brands (si no existe)

```json
{
  "ruleId": "negative_scope.competitor_brand",
  "appliesTo": "item",
  "ucrSection": "G",
  "severity": "critical",
  "when": {
    "op": "any_match",
    "left": "$item.keyword",
    "right": "$ucr.G.competitor_brands"
  },
  "then": {
    "set": {
      "disposition": "OUT_OF_PLAY",
      "reason": "Competitor brand term"
    },
    "trace": true
  }
}
```

âœ… **Resultado esperado:**
Keywords como:

* `20 week marathon training plan pdf`
* `are sandals business casual`
* `can you shoes`

â†’ **OUT_OF_PLAY inmediato**, sin pasar por H.

---

# ğŸ§± PASO 2 â€” ARREGLAR GATE H (SCORING REAL)

ğŸ“ **Archivo:**
`UCR.H` (config / seed / UI editable)

### 2.1 Cambiar thresholds (OBLIGATORIO)

ğŸ‘‰ **Reemplazar**:

```json
"thresholds": {
  "pass": 0.50,
  "review": 0.25
}
```

ğŸ‘‰ **Por**:

```json
"thresholds": {
  "pass": 0.65,
  "review": 0.35
}
```

ğŸ“Œ Regla que el dev debe respetar en el engine:

```ts
if (capabilityScore < review) â†’ OUT_OF_PLAY
if (capabilityScore >= pass) â†’ PASS
else â†’ REVIEW
```

---

### 2.2 Agregar boosters y penalties reales (CLAVE)

ğŸ‘‰ **Agregar en `UCR.H`**:

```json
"boosters": [
  { "pattern": "recovery", "weight": 0.15 },
  { "pattern": "plantar fasciitis", "weight": 0.20 },
  { "pattern": "arch support", "weight": 0.10 },
  { "pattern": "after running", "weight": 0.10 }
],
"penalties": [
  { "pattern": "training plan", "weight": -0.30 },
  { "pattern": "pdf", "weight": -0.50 },
  { "pattern": "marathon", "weight": -0.20 }
]
```

ğŸ“Œ **NO tocar el baseScore (0.5)**
ğŸ“Œ **NO aplicar thresholds dentro del scorer**

---

# ğŸ§± PASO 3 â€” CATEGORY FENCE B (NO MÃS â€œMATCHES COREâ€ FÃCIL)

ğŸ“ **Archivo:**
`UCR.B`

### 3.1 Separar core vs extended

```json
"B": {
  "core_terms": [
    "recovery footwear",
    "recovery sandals",
    "recovery shoes",
    "oofos"
  ],
  "extended_terms": [
    "arch support",
    "plantar fasciitis",
    "supportive sandals",
    "after workout",
    "comfort shoes"
  ]
}
```

### 3.2 LÃ³gica obligatoria en Gate B

ğŸ“Œ **Implementar asÃ­ (no inventar):**

```ts
if (matches core_terms) â†’ in_fence
else if (matches extended_terms) â†’ in_fence
else â†’ outside_fence = true
```

âš ï¸ `outside_fence` **NUNCA** puede producir PASS directo
â†’ como mÃ¡ximo REVIEW.

---

# ğŸ§± PASO 4 â€” FORZAR REVIEW A EXISTIR (ANTI-PASS-SPAM)

ğŸ“ **Archivo:**
`shared/rules/packs/keyword.scoring.v1.json`

ğŸ‘‰ **Agregar esta regla al final**:

```json
{
  "ruleId": "scoring.force_review_if_outside_fence",
  "appliesTo": "item",
  "ucrSection": "B",
  "severity": "medium",
  "when": {
    "op": "and",
    "conditions": [
      { "op": "eq", "left": "$item.outside_fence", "right": true },
      { "op": "lt", "left": "$item.capabilityScore", "right": "$ucr.H.thresholds.pass" }
    ]
  },
  "then": {
    "set": {
      "disposition": "REVIEW",
      "reason": "Outside category fence â€” requires human validation"
    },
    "trace": true
  }
}
```

âœ… Esto garantiza:

* REVIEW > 0%
* PASS solo cuando **realmente fuerte**

---

# ğŸ§± PASO 5 â€” DEBUG OBLIGATORIO (1 corrida)

ğŸ“ **En el gateway**, loggear por keyword:

```ts
{
  keyword,
  capabilityScore,
  outsideFence,
  finalDisposition,
  failedGate: "G" | "B" | "H" | null
}
```

ğŸ“Š **Esperado despuÃ©s del fix**:

| Disposition | % esperado |
| ----------- | ---------- |
| PASS        | 10â€“25%     |
| REVIEW      | 30â€“45%     |
| OUT_OF_PLAY | 35â€“55%     |

ğŸš¨ Si REVIEW = 0% â†’ **FAIL**

---

# ğŸ§ª TESTS MANUALES QUE EL DEV DEBE CORRER

| Keyword                              | Resultado correcto |
| ------------------------------------ | ------------------ |
| `nike recovery sandals`              | OUT (G)            |
| `20 week marathon training plan pdf` | OUT (G)            |
| `are sandals business casual`        | OUT (G)            |
| `best recovery sandals`              | PASS               |
| `arch support slippers`              | REVIEW o PASS      |
| `comfort shoes`                      | REVIEW             |

---

# ğŸ§  REGLA DE ORO PARA EL DEV

> **Si todo es PASS â†’ el sistema estÃ¡ roto**
> **Si todo es OUT â†’ el sistema estÃ¡ roto**
> **REVIEW es seÃ±al de salud**

---

## âœ… LISTO

Estas instrucciones son **suficientes para corregir el problema actual** sin rediseÃ±ar nada.

Si querÃ©s, el prÃ³ximo paso natural es:

* crear un **preset â€œOOFOS Calibration v1â€** reusable
* o definir un **modo warm-up** para nuevos clientes
* o instrumentar mÃ©tricas automÃ¡ticas de â€œPASS inflationâ€

Decime cuÃ¡l seguimos.
